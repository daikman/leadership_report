<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <link href="https://emeraldworks.com/Content/css/styles.bundle.css?v=120768920858" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.4.0/d3.min.js" charset="utf-8"></script>
    <style media="screen">
      .footnotes-area {
        font-size: 0.8em;
        padding-left: 2%;
      }
      .md-footnote {
        background-color: #f0f0f0;
        padding: 2px;
        border-radius: 10px;
        font-size: 0.7em;
      }
      hr {
        display: block;
        margin-top: 0.5em;
        margin-bottom: 0.5em;
        margin-left: auto;
        margin-right: auto;
        border-style: inset;
        border-width: 1px;
      }
      details {
        font-size: 0.9em;
      }
      .box-banner-wrapper {
        padding-left: 15%;
        padding-right: 15%;
        font-size: 0.9em;
      }
    </style>
    <title>EW Leadership Report</title>
  </head>
<body onresize="location.reload();">
  <div class="section section--white" id="main_container">
    <div class="container">
      <div class="section_body" style="font-size: 1.2em; padding-left: 0%; padding-right: 0%;">

<br>
<hr>


<br>
<h4 id="figure_1">Figure 1</h4>
<hr>
<h3> the percentage of leaders who chose the following issues as
  <select class = "h3" style = "border-style: dashed; border-radius: 4px; cursor: pointer" name="goals_choice" id="goals_choice"
  onchange = "if (this.selectedIndex == 1) {update_goal_chart(1)} else {update_goal_chart(5)}">
    <option value="5"><h3>a top 5 priority</h3></option>
    <option value="1"><h3>the top priority</h3></option>
  </select>
    for L&D</h3>
<em style="font-size:0.8em">Use the drop down menu above to manipulate this chart, and hover your mouse over any of the bars for more information</em>
<div>
  <svg id = "goal_chart"></svg>
</div>
<hr>

<br>
<h4 id="figure_2">Figure 2</h4>
<hr>
<h3>How leaders perceived L&D contributions to their top five priorities -
  <select class = "h3" style = "border-style: dashed; border-radius: 4px; cursor: pointer" name="goals_choice" id="goals_choice"
  onchange = "if (this.selectedIndex == 0) {update_contrib(stacked_goals)} else
  { if (this.selectedIndex == 1) {update_contrib(stacked_goals_eu)} else {
    update_contrib(stacked_goals_am)
  }
}">
    <option><h3>Global</h3></option>
    <option><h3>Europe</h3></option>
    <option><h3>Americas</h3></option>
  </select>
</h3>
<em style="font-size:0.8em">Hover your mouse over any of the bars for more information. "Global" includes Europe, the Americas, Asia, Africa and Oceania.</em>
<div>
  <svg id="contrib_legend"></svg>
  <svg id="contrib_chart"></svg>
</div>
<hr>

<br>
<h4 id="figure_3">Figure 3</h4>
<hr>
<h3>Leaders&#39; concerns about L&D -
  <select class = "h3" style = "border-style: dashed; border-radius: 4px; cursor: pointer" name="goals_choice" id="goals_choice"
  onchange = "if (this.selectedIndex == 0) {update_concern(stacked_concern)} else
  { if (this.selectedIndex == 1) {update_concern(stacked_concern_eu)} else {
    update_concern(stacked_concern_am)
  }
}">
    <option><h3>Global</h3></option>
    <option><h3>Europe</h3></option>
    <option><h3>Americas</h3></option>
  </select>
</h3>
<em style="font-size:0.8em">Hover your mouse over any of the bars for more information. "Global" includes Europe, the Americas, Asia, Africa and Oceania.</em>

<div>
  <svg id="concern_legend"></svg>
  <svg id="concern_chart"></svg>
</div>
<hr>

<br>
<h4 id="figure_4">Figure 4</h4>
<hr>
<!-- <h3>Leadership and L&D priorities, and L&D success</h3> -->
<div>
  <!-- <br> -->
  <svg id="compare_chart"></svg>
  <div style="padding-left: 1%; padding-bottom: 1%; font-size: 0.8em">
    <p><strong>How to use</strong>: click on a priority area in the left-hand column. The rest of the chart will update to show you how leaders and L&amp;D professionals rank this priority, and the L&amp;D success in this area.
    <br><strongstyle="font-size: 1.2em">*</strong>This rank is based on how often each goal was selected as a top five priority - 1st = most often.
    <br><strong style="font-size: 1.2em">&#8224;</strong>Percentage of success refers to the proportion of L&D professionals who said their department have made successful contributions to the selected priority.
      "2021 average" refers to all data from <em>2020</em>, establishing a benchmark for 2021.
      "Top performers" refers to the most well developed departments of 2020, considering a wide range of factors.</p>
  </div>
</div>
<hr>
</div>
</div>
</div>

<!-- DATA and colors -->
<script type="text/javascript">
  const goals_data = [
    {"goal":"Quality of work performed","top_5":79,"top_1":49,"no":0,"small":7,"mod":45,"sig":48,"am.no":0,"am.sm":0,"am.mod":40,"am.sig":60,"eu.no":0,"eu.sm":0,"eu.mod":62,"eu.sig":38},
    {"goal":"Business transformation, innovation and growth","top_5":65,"top_1":19,"no":6,"small":36,"mod":32,"sig":25,"am.no":0,"am.sm":27,"am.mod":47,"am.sig":26,"eu.no":9,"eu.sm":38,"eu.mod":27,"eu.sig":25},
    {"goal":"Digital environment and capability","top_5":38,"top_1":7,"no":3,"small":36,"mod":46,"sig":15,"am.no":10,"am.sm":30,"am.mod":60,"am.sig":0,"eu.no":2,"eu.sm":37,"eu.mod":44,"eu.sig":17},
    {"goal":"Organizational performance","top_5":37,"top_1":7,"no":3,"small":23,"mod":35,"sig":38,"am.no":0,"am.sm":0,"am.mod":33,"am.sig":67,"eu.no":4,"eu.sm":29,"eu.mod":35,"eu.sig":31},
    {"goal":"Employee engagement and motivation","top_5":33,"top_1":3,"no":4,"small":27,"mod":36,"sig":32,"am.no":0,"am.sm":33,"am.mod":13,"am.sig":53,"eu.no":6,"eu.sm":26,"eu.mod":36,"eu.sig":32},
    {"goal":"Development of agile working","top_5":32,"top_1":2,"no":5,"small":23,"mod":45,"sig":26,"am.no":5,"am.sm":29,"am.mod":48,"am.sig":19,"eu.no":2,"eu.sm":24,"eu.mod":38,"eu.sig":35},
    {"goal":"Learning culture","top_5":32,"top_1":5,"no":4,"small":24,"mod":36,"sig":37,"am.no":0,"am.sm":15,"am.mod":38,"am.sig":46,"eu.no":6,"eu.sm":26,"eu.mod":31,"eu.sig":37},
    {"goal":"Organizational reputation","top_5":29,"top_1":1,"no":5,"small":23,"mod":45,"sig":26,"am.no":0,"am.sm":0,"am.mod":50,"am.sig":50,"eu.no":14,"eu.sm":28,"eu.mod":43,"eu.sig":14},
    {"goal":"Organizational problem solving","top_5":29,"top_1":5,"no": 2,"small":10,"mod":35,"sig":50,"am.no":0,"am.sm":8,"am.mod":41,"am.sig":50,"eu.no":3,"eu.sm":11,"eu.mod":33,"eu.sig":53},
    {"goal":"Talent strategies","top_5":28,"top_1":2,"no":6,"small":29,"mod":35,"sig":29,"am.no":0,"am.sm":38,"am.mod":6,"am.sig":56,"eu.no":9,"eu.sm":30,"eu.mod":44,"eu.sig":19},
    {"goal":"Customer satisfaction","top_5":26,"top_1":1,"no":6,"small":29,"mod":38,"sig":27,"am.no":9,"am.sm":18,"am.mod":27,"am.sig":45,"eu.no":5,"eu.sm":32,"eu.mod":41,"eu.sig":22},
    {"goal":"Business intelligence","top_5":25,"top_1":1,"no":18,"small":26,"mod":44,"sig":12,"am.no":25,"am.sm":50,"am.mod":25,"am.sig":0,"eu.no":16,"eu.sm":24,"eu.mod":48,"eu.sig":12},
    // {"goal":"Regulatory requirements","top_5":25,"top_1":10,"no":0,"small":85,"mod":8,"sig":8},
    {"goal":"Employee productivity","top_5":24,"top_1":3,"no":9,"small":28,"mod":28,"sig":35,"am.no":18,"am.sm":9,"am.mod":9,"am.sig":64,"eu.no":6,"eu.sm":34,"eu.mod":34,"eu.sig":25},
    {"goal":"Reduction of operational costs","top_5":22,"top_1":4,"no":18,"small":50,"mod":20,"sig":13,"am.no":8,"am.sm":38,"am.mod":23,"am.sig":31,"eu.no":23,"eu.sm":53,"eu.mod":20,"eu.sig":5},
    {"goal":"Attraction of talent","top_5":22,"top_1":2,"no":3,"small":22,"mod":33,"sig":41,"am.no":0,"am.sm":17,"am.mod":16,"am.sig":67,"eu.no":5,"eu.sm":23,"eu.mod":35,"eu.sig":37},
    {"goal":"Improvement of future critical capabilities","top_5":18,"top_1":4,"no":12,"small":24,"mod":48,"sig":17,"am.no":9,"am.sm":36,"am.mod":36,"am.sig":18,"eu.no":12,"eu.sm":19,"eu.mod":52,"eu.sig":16},
    {"goal":"Business expansion","top_5":16,"top_1":4,"no":17,"small":40,"mod":36,"sig":7,"am.no":33,"am.sm":33,"am.mod":25,"am.sig":8,"eu.no":8,"eu.sm":44,"eu.mod":44,"eu.sig":4},
    {"goal":"Communication and teamwork","top_5":14,"top_1":1,"no":3,"small":18,"mod":53,"sig":26,"am.no":0,"am.sm":18,"am.mod":73,"am.sig":9,"eu.no":4,"eu.sm":17,"eu.mod":43,"eu.sig":35},
    {"goal":"Staff retention","top_5":12,"top_1":0,"no":4,"small":26,"mod":22,"sig":48,"am.no":0,"am.sm":27,"am.mod":9,"am.sig":64,"eu.no":6,"eu.sm":25,"eu.mod":31,"eu.sig":38},
    {"goal":"Staff compliance","top_5":11,"top_1":0,"no":3,"small":23,"mod":55,"sig":19,"am.no":0,"am.sm":40,"am.mod":50,"am.sig":24,"eu.no":5,"eu.sm":14,"eu.mod":57,"eu.sig":24},
    {"goal":"Learning in the workflow","top_5":10,"top_1":0,"no":9,"small":41,"mod":33,"sig":17,"am.no":0,"am.sm":30,"am.mod":50,"am.sig":20,"eu.no":11,"eu.sm":44,"eu.mod":28,"eu.sig":17}
  ].reverse();

  const contrib_color = d3.scaleOrdinal()
                          .domain(["no", "small", "mod", "sig"])
                          .range(["#fe3298", "#fe3298", "#329799", "#329799"])

  const concern_data = [
    {"barrier": "Focus on short term issues", "extreme":34,"some":39,"none":27,"e.am":28,"s.am":52,"n.am":20,"e.eu":35,"s.eu":39,"n.eu":26},
    {"barrier": "Lack of investment or shortage of resources","extreme":29,"some":48,"none":23,"e.am":44,"s.am":36,"n.am":20,"e.eu":24,"s.eu":51,"n.eu":25},
    {"barrier": "Lack of high-quality content","extreme":21,"some":50,"none":29,"e.am":16,"s.am":44,"n.am":40,"e.eu":21,"s.eu":52,"n.eu":27},
    {"barrier": "Lack of strategic L&D influence","extreme":18,"some":55,"none":27,"e.am":13,"s.am":58,"n.am":29,"e.eu":19,"s.eu":54,"n.eu":27},
    {"barrier": "Organizational learning is not valued enough","extreme":22,"some":47,"none":31,"e.am":16,"s.am":52,"n.am":32,"e.eu":22,"s.eu":48,"n.eu":31},
    {"barrier": "Employees cannot manage own learning","extreme":18,"some":51,"none":31,"e.am":24,"s.am":48,"n.am":28,"e.eu":16,"s.eu":49,"n.eu":36},
    {"barrier": "Unreliable IT infrastructure","extreme":17,"some":39,"none":44,"e.am":36,"s.am":28,"n.am":36,"e.eu":11,"s.eu":41,"n.eu":49},
    {"barrier": "Reluctance of managers to engage with learning","extreme":15,"some":40,"none":45,"e.am":20,"s.am":32,"n.am":48,"e.eu":8,"s.eu":44,"n.eu":48},
    {"barrier": "Structural change of the learning team","extreme":14,"some":40,"none":46,"e.am":16,"s.am":28,"n.am":56,"e.eu":12,"s.eu":42,"n.eu":46},
    {"barrier": "Focus on individual rather than team success","extreme":9,"some":46,"none":45,"e.am":0,"s.am":50,"n.am":50,"e.eu":10,"s.eu":45,"n.eu":45},
  ].reverse();

  const compare_data = [
    {"goal": "Innovation and business growth","leader":"2nd","ld_rank":"15th+","ld_ach":21,"tp":38},
    {"goal": "Organizational performance","leader":"4th","ld_rank":"5th","ld_ach":25,"tp":45},
    {"goal": "Employee engagement","leader":"5th","ld_rank":"3rd","ld_ach":24,"tp":46},
    {"goal": "Learning culture","leader":"7th","ld_rank":"1st","ld_ach":22,"tp":38},
    // {"goal": "Build problem solving capability","leader":"9th","ld_rank":"13th","ld_ach":22,"tp":43},
    {"goal": "Business intelligence","leader":"12th","ld_rank":"15th+","ld_ach":16,"tp":26},
    {"goal": "Job productivity","leader":"14th","ld_rank":"15th+","ld_ach":27,"tp":50},
    {"goal": "Communication and teamwork","leader":"15th+","ld_rank":"9th","ld_ach":28,"tp":49},
    {"goal": "Learning within the workflow","leader":"15th+","ld_rank":"15th+","ld_ach":20,"tp":26},
    {"goal": "Attracting talent","leader":"15th+","ld_rank":"15th+","ld_ach":34,"tp":61},
    {"goal": "Compliance with regulations","leader":"15th+","ld_rank":"15th+","ld_ach":64,"tp":81},
    {"goal": "Business expansion","leader":"15th+","ld_rank":"15th+","ld_ach":25,"tp":24}
  ]

</script>

<!-- GOAL CHART, appends to svg with id "goal_chart" -->
<script type="text/javascript">

  // set some attributes of svg
  d3.select("#goal_chart")
    .attr("height", "500px")
    .attr("width", "100%")

  // set the dimensions and margins of the graph
  var margin = {top: 20, right: 50, bottom: 30, left: 370},
    width = d3.select("#goal_chart").node().getBoundingClientRect().width - margin.left - margin.right,
    height = d3.select("#goal_chart").node().getBoundingClientRect().height - margin.top - margin.bottom;

  // set the ranges
  var goals_y = d3.scaleBand()
                  .range([height, 0])
                  .padding(0.1);

  var goals_x = d3.scaleLinear()
                  .range([0, width]);

  // append the svg object to the body of the page
  // append a 'group' element to 'svg'
  // moves the 'group' element to the top left margin
  var goals_svg = d3.select("#goal_chart")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

  // Scale the range of the data in the domains
  goals_x.domain([0, 80])
  goals_y.domain(goals_data.map(function(d) { return d.goal; }));

  // append the rectangles for the bar chart
  goals_svg.selectAll("rect")
     .data(goals_data)
     .enter()
     .append("rect")
     .attr("fill", "#31ab91")
     .attr("y", function(d) { return goals_y(d.goal); })
     .attr("height", goals_y.bandwidth())
     .attr("width", 0)
     .on("mouseover", function(d, i) {

       // highlight current bar and text
       var barUnderMouse = this;
       d3.select("#goal_chart").selectAll('rect').transition("opacity").style('opacity', function() {
         return (this === barUnderMouse) ? 1.0 : 0.5;
       });

       d3.select("#goal_chart").select(".goals_desc").selectAll('text').transition("opacity").style('opacity', function(d) {
         return (d.goal === i.goal) ? 1.0 : 0;
       })

       d3.select("#goal_chart").selectAll(".yAxis text").transition("opacity").attr("font-weight", d => {
         return (d === i.goal) ? "bold" : "normal"
       })
     })

     .on("mouseout", ()=> {
       d3.select("#goal_chart").selectAll('rect').transition("opacity").style('opacity', 1);
       d3.select("#goal_chart").select(".goals_desc").selectAll('text').transition("opacity").style('opacity', 0);
       d3.select("#goal_chart").selectAll(".yAxis text").transition("opacity").attr("font-weight", "normal");
     })

  // add the x Axis
  goals_svg.append("g")
     .attr("class", "xAxis")
     .attr("transform", "translate(0," + height + ")")
     .call(
       d3.axisBottom(goals_x)
          .tickFormat((d) => { return d + "%" })
          .tickSize(-height)
      )

  d3.selectAll(".domain")
    .attr("opacity", 0)

  d3.selectAll(".tick line")
    .attr("opacity", 0.6)
    .style("")

  // add the y Axis
  goals_svg.append("g")
     .attr("class", "yAxis")
     .call(d3.axisLeft(goals_y));

  d3.selectAll(".tick text")
   .attr("font-size","1.5em")
   .attr("font-family", "sans-serif")

   // percentage labels
   var goals_desc = d3.select("#goal_chart")
                      .select("g")
                      .append("g")
                      .attr("class", "goals_desc")
                      .selectAll("p")
                      .data(goals_data)
                      .enter()
                      .append("text")
                      .attr("opacity", 0)
                      .attr("x", 0)
                      .attr("y", d => {return goals_y(d.goal) + goals_y.bandwidth() - 3})

  // animate bars from 0 to data value
  const update_goal_chart = function(user_select) {

    goals_svg.selectAll("rect")
       //.attr("width", 0)
       .transition("grow")
       .duration(800)
       // /.attr("width", function(d) {return 0;})
       .attr("width", function(d) {
         if (user_select == 5) {
           return goals_x(d.top_5);
         } else {
           return goals_x(d.top_1);
         }
       })
       .delay(function(d,i){return(i*50)})

    if (user_select == 5) {
      goals_desc.text((d) => d.top_5 + "%")
                .transition("label-move")
                .duration(800)
                .attr("x", d => {return goals_x(d.top_5) + 6})
                .delay(function(d,i){return(i*50)})
    } else {
      goals_desc.text((d) => d.top_1 + "%")
                .transition("label-move")
                .duration(800)
                .attr("x", d => {return goals_x(d.top_1) + 6})
                .delay(function(d,i){return(i*50)})
    }
  }

  // initialise as showing top five percentages
  update_goal_chart(5)
</script>

<!-- CONTRIB CHART, svg id "contrib_chart" -->
<script type="text/javascript">

  // "stacking" data for stacked bar chart
  const stackGoals = d3.stack().keys(["no", "small", "mod", "sig"])
  const stackGoalsAm = d3.stack().keys(["am.no", "am.sm", "am.mod", "am.sig"])
  const stackGoalsEU = d3.stack().keys(["eu.no", "eu.sm", "eu.mod", "eu.sig"])

  const stacked_goals = stackGoals(goals_data)
  const stacked_goals_am = stackGoalsAm(goals_data)
  const stacked_goals_eu = stackGoalsEU(goals_data)

  // set some attributes of svg
  d3.select("#contrib_chart")
    .attr("height", "500px")
    .attr("width", "100%")

  const update_contrib = function(data) {

    d3.select("#contrib_chart").selectAll("g").remove()

    // set the dimensions and margins of the graph
    var margin = {top: 5, right: 50, bottom: 30, left: 370},
      width = d3.select("#contrib_chart").node().getBoundingClientRect().width - margin.left - margin.right,
      height = d3.select("#contrib_chart").node().getBoundingClientRect().height - margin.top - margin.bottom;

    // make new x scale, so it can have different domain
    var contrib_x = d3.scaleLinear()
                    .range([0, width]);

    var contrib_y = d3.scaleBand()
                    .range([height, 0])
                    .padding(0.1);

    // append the svg object to the body of the page
    // append a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var contrib_svg = d3.select("#contrib_chart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")");

    // Scale the range of the data in the domains
    contrib_x.domain([0, 100])
    contrib_y.domain(goals_data.map(function(d) { return d.goal; }));

    // bar and text groups
    var bars = contrib_svg.append("g").attr("class", "contrib_desc")
       .selectAll("g")
       // Enter in the stack data = loop key per key = group per group
       .data(data)
       .enter().append("g")

    // append the rectangles for the bar chart
    bars
       .attr("fill", (d, i) => contrib_color(d.key))
       .attr("opacity", (d, i) => [1, 0.7, 0.7, 1][i])
       .selectAll("rect")
       .data(d => d)
       .enter().append("rect")
       .attr("y", d => { return contrib_y(d.data.goal); })
       .attr("x", d => contrib_x(d[0]))
       .attr("stroke", "white")
       .attr("stroke-width", 2)
       .attr("height", contrib_y.bandwidth())
       .attr("width", d => {
         // hard-coding 'solution' to rounding problem
         if (d[1] < 97) {
           return(contrib_x(d[1]) - contrib_x(d[0]))
         } else {
           return(contrib_x(100) - contrib_x(d[0]))
         }
       })
       .on("mouseover", function(d, i) {

         // highlight current bar and text
         var barUnderMouse = this;
         d3.select("#contrib_chart").selectAll('rect').transition("opacity")
           .style('opacity', function() {
           return (this === barUnderMouse) ? 1.0 : 0.5;
           })
           // .attr("fill", function() {
           // return (this === barUnderMouse) ? {} : "grey";
           // })

         d3.select("#contrib_chart").selectAll('rect').transition("opacity").style('opacity', function() {
           return (this === barUnderMouse) ? 1.0 : 0.2;
         })

         bars.append("text")
             .data(i)
             .text(i[1] - i[0] + "%")
             .attr("fill", "black")
             .attr("x", contrib_x(100) + 2)
             .attr("y", contrib_y(i.data.goal) + contrib_y.bandwidth() - 3)

         d3.select("#contrib_chart").selectAll(".yAxis text").transition("opacity").attr("font-weight", d => {
           return (d === i.data.goal) ? "bold" : "normal"
         })

       })
       .on("mouseout", (d, i) => {
         d3.select("#contrib_chart").selectAll('rect').transition("opacity").style('opacity', 1);
         d3.select("#contrib_chart").select(".contrib_desc").selectAll('text').transition("opacity").style('opacity', 0)
         d3.select("#contrib_chart").selectAll(".yAxis text").transition("opacity").attr("font-weight", "normal");
         bars.selectAll('text').remove()
       })

    // add the x Axis
    contrib_svg.append("g")
       .attr("class", "xAxis")
       .attr("transform", "translate(0," + height + ")")
       .call(
         d3.axisBottom(contrib_x)
            .tickFormat((d) => { return d + "%" })
            .tickSize(-height)
        )

    d3.selectAll(".domain")
      .attr("opacity", 0)

    d3.selectAll(".tick line")
      .attr("opacity", 0.6)
      .style("")

    // add the y Axis
    contrib_svg.append("g")
       .attr("class", "yAxis")
       .call(d3.axisLeft(contrib_y));

    d3.selectAll(".tick text")
     .attr("font-size","1.5em")
     .attr("font-family", "sans-serif")
  }

  update_contrib(stacked_goals)

  // legend
  legend_svg = d3.select("#contrib_legend")
    .attr("width", "100%")
    .attr("height", "50px")
    .selectAll("g")
    .data([0,1,2,3])
    .enter()

  var width = d3.select("#contrib_legend").node().getBoundingClientRect().width,
    height = d3.select("#contrib_legend").node().getBoundingClientRect().height;

  var legend_locs = [0.9*width/7, 3*width/7, 4*width/7, 5*width/7, 6*width/7]
  // rectangles
  legend_svg
    .append("rect")
    .attr("y", 20)
    .attr("x", d => legend_locs[d+1])
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", d => contrib_color((contrib_color.domain()[d])))
    .attr("opacity", d => [1, 0.7, 0.7, 1][d])

  // text
  legend_svg
    .append("text")
    .text(d => ["none", "small", "moderate", "significant"][d])
    .attr("text-anchor", "end")
    .attr("y", 35)
    .attr("x", d => legend_locs[d+1] - 2)

  // legend title
  d3.select("#contrib_legend")
    //.append("p")
    .append("text")
    .text("Perceived contribution:")
    .attr("y", 35)
    .attr("x", legend_locs[0])
    .attr("font-weight", "bold")



</script>

<!-- CONCERN CHART, svg id "concern_chart" -->
<script type="text/javascript">

  // "stacking" data for stacked bar chart
  const stackConcern = d3.stack().keys(["extreme", "some", "none"])
  const stackConcernAm = d3.stack().keys(["e.am", "s.am", "n.am"])
  const stackConcernEU = d3.stack().keys(["e.eu", "s.eu", "n.eu"])

  const stacked_concern = stackConcern(concern_data)
  const stacked_concern_am = stackConcernAm(concern_data)
  const stacked_concern_eu = stackConcernEU(concern_data)

  // set some attributes of svg
  d3.select("#concern_chart")
    .attr("height", "300px")
    .attr("width", "100%")

  const update_concern = function(data) {

    d3.select("#concern_chart").selectAll("g").remove()

    // set the dimensions and margins of the graph
    var margin = {top: 5, right: 50, bottom: 30, left: 370},
      width = d3.select("#concern_chart").node().getBoundingClientRect().width - margin.left - margin.right,
      height = d3.select("#concern_chart").node().getBoundingClientRect().height - margin.top - margin.bottom;

    // make new x scale, so it can have different domain
    // var contrib_x = d3.scaleLinear()
    //                 .range([0, width]);
    //
    var concern_y = d3.scaleBand()
                      .range([height, 0])
                      .padding(0.1);

    var concern_x = d3.scaleLinear()
                    .range([0, width]);

    // append the svg object to the body of the page
    // append a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var concern_svg = d3.select("#concern_chart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                  "translate(" + margin.left + "," + margin.top + ")");

    // Scale the range of the data in the domains
    //contrib_x.domain([0, 100])
    concern_y.domain(concern_data.map(function(d) { return d.barrier; }));
    concern_x.domain([0, 100])

    // bar and text groups
    var concern_bars = concern_svg.append("g").attr("class", "contrib_desc")
       .selectAll("g")
       // Enter in the stack data = loop key per key = group per group
       .data(data)
       .enter().append("g")

    // append the rectangles for the bar chart
    concern_bars
       .attr("fill", (d, i) => ["#fe3298", "#fe3298", "#329799"][i])
       .attr("opacity", (d, i) => [1, 0.7, 0.7, 1][i])
       .selectAll("rect")
       .data(d => d)
       .enter().append("rect")
       .attr("y", d => { return concern_y(d.data.barrier); })
       .attr("stroke", "white")
       .attr("stroke-width", 2)
       .on("mouseover", function(d, i) {

         // highlight current bar and text
         var barUnderMouse = this;
         d3.select("#concern_chart").selectAll('rect').transition("opacity")
           .style('opacity', function() {
           return (this === barUnderMouse) ? 1.0 : 0.5;
           })
           // .attr("fill", function() {
           // return (this === barUnderMouse) ? {} : "grey";
           // })

         d3.select("#concern_chart").selectAll('rect').transition("opacity").style('opacity', function() {
           return (this === barUnderMouse) ? 1.0 : 0.2;
         })

         concern_bars.append("text")
             .data(i)
             .text(i[1] - i[0] + "%")
             .attr("fill", "black")
             .attr("x", concern_x(100) + 2)
             .attr("y", concern_y(i.data.barrier) + concern_y.bandwidth()/2 + 5)

         d3.select("#concern_chart").selectAll(".yAxis text").transition("opacity").attr("font-weight", d => {
           return (d === i.data.barrier) ? "bold" : "normal"
         })

       })
       .on("mouseout", (d, i) => {
         d3.select("#concern_chart").selectAll('rect').transition("opacity").style('opacity', 1);
         d3.select("#concern_chart").select(".contrib_desc").selectAll('text').transition("opacity").style('opacity', 0)
         d3.select("#concern_chart").selectAll(".yAxis text").transition("opacity").attr("font-weight", "normal");
         concern_bars.selectAll('text').remove()
       })
       .attr("height", concern_y.bandwidth())
       // .transition("enter")
       // .duration(1000)
       .attr("x", d => concern_x(d[0]))
       .attr("width", d => {
         // hard-coding 'solution' to rounding problem
         if (d[1] < 97) {
           return(concern_x(d[1]) - concern_x(d[0]))
         } else {
           return(concern_x(100) - concern_x(d[0]))
         }

       })

       // add the x Axis
       concern_svg.append("g")
          .attr("class", "xAxis")
          .attr("transform", "translate(0," + height + ")")
          .call(
            d3.axisBottom(concern_x)
               .tickFormat((d) => { return d + "%" })
               .tickSize(-height)
           )

       d3.selectAll(".domain")
         .attr("opacity", 0)

       d3.selectAll(".tick line")
         .attr("opacity", 0.6)
         .style("")

       // add the y Axis
       concern_svg.append("g")
          .attr("class", "yAxis")
          .call(d3.axisLeft(concern_y));

       d3.selectAll(".tick text")
        .attr("font-size","1.5em")
        .attr("font-family", "sans-serif")

  }

  update_concern(stacked_concern)

  // legend
  concern_legend_svg = d3.select("#concern_legend")
    .attr("width", "100%")
    .attr("height", "50px")
    .selectAll("g")
    .data([0,1,2])
    .enter()

  var width = d3.select("#concern_legend").node().getBoundingClientRect().width,
  height = d3.select("#concern_legend").node().getBoundingClientRect().height;

  var legend_locs = [2*width/7, 4*width/7, 5*width/7, 6*width/7]

  // rectangles
  concern_legend_svg
    .append("rect")
    .attr("y", 20)
    .attr("x", d => legend_locs[d+1])
    .attr("width", 20)
    .attr("height", 20)
    .attr("fill", d => contrib_color((contrib_color.domain()[d])))
    .attr("opacity", d => [1, 0.7, 1][d])

  // text
  concern_legend_svg
    .append("text")
    .text(d => ["extreme", "some", "none"][d])
    .attr("text-anchor", "end")
    .attr("y", 35)
    .attr("x", d => legend_locs[d+1] - 3)

  // legend title
  d3.select("#concern_legend")
    //.append("p")
    .append("text")
    .text("Level of concern:")
    .attr("y", 35)
    .attr("x", legend_locs[0])
    .attr("font-weight", "bold")


</script>

<!-- COMPARE CHART, svg id "compare_chart" -->
<script type="text/javascript">

  // set the dimensions and margins of the graph
  const compare_svg =  d3.select("#compare_chart")
                         .attr("width", "100%")
                         .attr("height", 300)
                         .append("g")
                         .attr("transform", "translate(0,20)")

  var margin = {top: 20, right: 50, bottom: 30, left: 100},
      width = d3.select("#compare_chart").node().getBoundingClientRect().width - margin.left - margin.right,
      height = d3.select("#compare_chart").node().getBoundingClientRect().height - margin.top - margin.bottom;

  compare_svg.append("text")
             .attr("id", "selected_goal_compare_chart")
             .text("Innovation and business growth")
             .attr("x", width/2.4 + width*0.07)
             .attr("y", 3)
             .attr("font-size", 32)
             .attr("text-decoration", "underline")

  // OPTIONS
  const goal_options_svg = compare_svg.append("g")
                                      .attr("class", "goal_options")

  // set default choice
  var user_choice = compare_data[0];

  // // arrows
  // goal_options_svg.selectAll("html")
  //                 .data(compare_data)
  //                 .enter()
  //                 .append("line")
  //                 .attr("x1", margin.left-50)
  //                 .attr("y1", (d, i) => margin.top + i*height/compare_data.length)
  //                 .attr("x2", width/3)
  //                 .attr("y2", (d, i) => margin.top + i*height/compare_data.length)
  //                 //.attr("fill", "white")
  //                 .attr("stroke", "#31ab91")
  //                 .on("click", (d, i) => {
  //                   set_new_rank_data(i)
  //                 })

  // text
  goal_options_svg.selectAll("text")
                  .data(compare_data)
                  .enter()
                  .append("text")
                  .attr("x", 5)
                  .attr("y", (d, i) => margin.top + i*height/compare_data.length)
                  .attr("font-weight", function(d, i) {
                    if (i == 0) {
                      return("bold")
                    } else {
                      return("normal")
                    }
                  })
                  .attr("font-size", function(d, i) {
                    if (i == 0) {
                      return("1.1em")
                    } else {
                      return("1em")
                    }
                  })
                  .html(d => "\u27A4 " + d.goal)
                  .on("click", function(d, i) {
                    goal_options_svg.selectAll("text").attr("font-weight", "normal")
                    goal_options_svg.selectAll("text").attr("font-size", "1em")
                    d3.select(this).attr("font-weight", "bold")
                    d3.select(this).attr("font-size", "1.1em")
                    set_new_rank_data(i)
                  })
                  .style("cursor", "pointer");
                  // .on("mouseover", function(d, i) {
                  //   //goal_options_svg.selectAll("line").datum()
                  //   d3.select(this).attr("font-weight", "bold")
                  //   d3.select(this).attr("font-size", "1.1em")
                  // })
                  // .on("mouseout", function() {
                  //   d3.select(this).attr("font-weight", "normal")
                  //   d3.select(this).attr("font-size", "1em")
                  // })

  // divided line
  compare_svg.append("line")
             .attr("x1", width/2.4 + width*0.05)
             .attr("y1", 0)
             .attr("x2", width/2.4 + width*0.05)
             .attr("y1", height)
             .attr("stroke", "#31ab91")

  // RANKS
  const goal_ranks_svg = compare_svg.append("g")
                                    .attr("class", "goal_ranks")
                                    .attr("transform", "translate(" + width/2.4 + "," + margin.top + ")")

  goal_ranks_svg.append("text")
                .attr("y", height/3)
                .attr("x", 0.07*width)
                .attr("font-weight", "bold")
                .attr("font-size", 24)
                .text("Leader priority rank*")
  // ranks
  goal_ranks_svg.append("text")
                .attr("id", "leader_rank_text")
                .attr("x", 0.12*width)
                .attr("y", margin.top + height/2)
                .attr("font-size", 54)
                .text(user_choice.leader)
                .attr("fill", "#31ab91")
  // line surround
  goal_ranks_svg.append("line")
                 .attr("x1", 0.07*width)
                 .attr("x2", 0.3*width)
                 .attr("y1", margin.top + height/1.85)
                 .attr("y2", margin.top + height/1.85)
                 .attr("stroke","black")
  goal_ranks_svg.append("line")
                .attr("x1", 0.07*width)
                .attr("x2", 0.3*width)
                .attr("y1", margin.top + height/3.2)
                .attr("y2", margin.top + height/3.2)
                .attr("stroke","black")

  // goal_ranks_svg.append("circle")
  //               .attr("cx", 0.18*width)
  //               .attr("cy", margin.top + height/2.25)
  //               .attr("r", 84)
  //               .attr("fill", "none")
  //               .attr("stroke", "black")

  // goal_ranks_svg.append("text")
  //               .attr("id", "ld_rank_text")
  //               .attr("x", 0.15*width)
  //               .attr("y", margin.top + 160)
  //               .attr("font-size", 36)
  //               .text(user_choice.ld_rank)
  //               .attr("fill", "#31ab91")

  // titles
  // goal_ranks_svg.append("text")
  //               .attr("x", 0.07*width)
  //               .attr("y", margin.top + 35)
  //               //.attr("font-weight", "bold")
  //               .attr("font-size", 24)
  //               .text("Leader")
  // goal_ranks_svg.append("line")
  //               .attr("x1", 0.07*width)
  //               .attr("y1", margin.top + 37)
  //               .attr("x2", 0.17*width)
  //               .attr("y2", margin.top + 37)
  //               .attr("stroke", "black")
  //
  // goal_ranks_svg.append("text")
  //               .attr("x", 0.07*width)
  //               .attr("y", margin.top + 120)
  //               //.attr("font-weight", "bold")
  //               .attr("font-size", 24)
  //               .text("L&D")
  // goal_ranks_svg.append("line")
  //               .attr("x1", 0.07*width)
  //               .attr("y1", margin.top + 122)
  //               .attr("x2", 0.17*width)
  //               .attr("y2", margin.top + 122)
  //               .attr("stroke", "black")


  // PERCENTAGES
  const perc = compare_svg.append("g")
                          .attr("transform", "translate(" + (2*width/2.7 + 10) + "," + margin.top + ")")
  perc.append("text")
      .html("Percentage of L&D success&#8224;")
      .attr("font-weight", "bold")
      .attr("font-size", 24)
      .attr("y", 20)

  // PERCENTAGE GAUGE TOP
  const fill_t = perc.append("g")
             .attr("transform", "translate(0," + (margin.top + 15 + (height-margin.top)/2) +")")
             .attr("height", 250)
             .attr("width", 250)

  fill_t.append("text")
        .attr("y", 10)
        .attr("font-size", 24)
        .text("Top performers' average")

  fill_t.append("rect")
        .attr("transform", "translate(0, 30)")
         .attr("height", 50)
         .attr("width", 150)
         .attr("fill", "#f0f0f0")

  fill_t.append("rect")
         .attr("transform", "translate(0, 30)")
         .attr("id", "fill_rect_tp")
         .attr("fill", "#31ab91")
         .attr("height", 50)
         .attr("width", user_choice.tp*1.5)

  fill_t.append("rect")
        .attr("transform", "translate(0, 30)")
        .attr("x", 150)
        .attr("y", -5)
        .attr("width", 2)
        .attr("height", 60)

  // text
  fill_t.append("text")
        .attr("id", "tween_percent_tp")
        .attr("transform", "translate(0, 30)")
        .attr("x", 170)
        .attr("y", 40)
        .attr("font-size", 50)
        .text(user_choice.tp)

  fill_t.append("text")
        .attr("transform", "translate(0, 30)")
        .attr("x", 230)
        .attr("y", 40)
        .attr("font-size", 50)
        //.attr("fill", "grey")
        .text("%")

  // PERCENTAGE GAUGE AVERAGE
  const fill_g = perc.append("g")
             .attr("transform", "translate( 0," + (margin.top + 25) +")")
             .attr("height", 250)
             .attr("width", 250)

  fill_g.append("text")
        .attr("y", 10)
        .attr("font-size", 24)
        .text("2021 average")

  fill_g.append("rect")
        .attr("transform", "translate(0, 30)")
         .attr("height", 50)
         .attr("width", 150)
         .attr("fill", "#f0f0f0")

  fill_g.append("rect")
         .attr("transform", "translate(0, 30)")
         .attr("id", "fill_rect_avg")
         .attr("fill", "#31ab91")
         .attr("height", 50)
         .attr("width", user_choice.ld_ach*1.5)

  fill_g.append("rect")
        .attr("transform", "translate(0, 30)")
        .attr("x", 150)
        .attr("y", -5)
        .attr("width", 2)
        .attr("height", 60)

  // text
  fill_g.append("text")
        .attr("id", "tween_percent_avg")
        .attr("transform", "translate(0, 30)")
        .attr("x", 170)
        .attr("y", 40)
        .attr("font-size", 50)
        .text(user_choice.ld_ach)

  fill_g.append("text")
        .attr("transform", "translate(0, 30)")
        .attr("x", 230)
        .attr("y", 40)
        .attr("font-size", 50)
        //.attr("fill", "grey")
        .text("%")


  // FUNCTION
  const set_new_rank_data = function(choice) {
    d3.select(leader_rank_text).text(choice.leader)
    //d3.select(ld_rank_text).text(choice.ld_rank)

    d3.select("#fill_rect_avg").transition("fill_up_rect_avg").duration(1000).attr("width", choice.ld_ach*1.5)
    d3.select("#tween_percent_avg").transition()
        .tween("text", function() {
          var selection = d3.select(this);    // selection of node being transitioned
          var start = d3.select(this).text(); // start value prior to transition
          var end = choice.ld_ach;                     // specified end value
          var interpolator = d3.interpolateNumber(start,end); // d3 interpolator

          return function(t) { selection.text(Math.round(interpolator(t))) };  // return value

        }).duration(1000);

    d3.select("#fill_rect_tp").transition("fill_up_rect_tp").duration(1000).attr("width", choice.tp*1.5)
    d3.select("#tween_percent_tp").transition()
        .tween("text", function() {
          var selection = d3.select(this);    // selection of node being transitioned
          var start = d3.select(this).text(); // start value prior to transition
          var end = choice.tp;                     // specified end value
          var interpolator = d3.interpolateNumber(start,end); // d3 interpolator

          return function(t) { selection.text(Math.round(interpolator(t))) };  // return value

        }).duration(1000);

    d3.select("#selected_goal_compare_chart").text(choice.goal)
  }
</script>

<!-- for dynamic iframe -->
<!-- <script type="text/javascript">
  let view_height;

  const sendPostMessage = () => {
    if (view_height !== document.getElementById('main_container').offsetHeight) {
      view_height = document.getElementById('main_container').offsetHeight;
      window.parent.postMessage({
        frameHeight: view_height
      }, '*');
      console.log(view_height);
    }
  }

  window.onload = () => setTimeout(sendPostMessage, 100);
  window.onresize = () => setTimeout(sendPostMessage, 100);
  document.getElementById('quick-summary').onclick = () => setTimeout(sendPostMessage, 100);
  document.getElementById('methodology').onclick = () => setTimeout(sendPostMessage, 100);
</script> -->

</body>
</html>
